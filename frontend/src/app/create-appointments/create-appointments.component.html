<div class="page">
  <header class="site-header">
    <div class="container nav">
      <div class="brand">
        <span class="brand-mark">LH</span>
        <span class="brand-text">Lynx Health</span>
      </div>
      <nav class="nav-links">
        <a routerLink="/home">Home</a>
        <a routerLink="/home" fragment="availability">Appointments</a>
        <a routerLink="/home" fragment="hours">Hours</a>
        <a *ngIf="role === 'admin'" routerLink="/create-appointments">Manage Availability</a>
      </nav>
      <div class="nav-actions">
        <span class="role-pill">{{ role === "admin" ? "Admin" : "User" }}</span>
        <a class="button small" routerLink="/login">Switch Role</a>
      </div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="container calendar-panel">
        <div class="calendar-header">
          <div>
            <h1>Block Off Appointment Times</h1>
            <p class="section-copy">Weekdays only Â· 9:00 AM to 3:45 PM. Click an available cell to block it, or a blocked cell to reopen it.</p>
          </div>
          <div class="calendar-actions">
            <button class="button ghost" type="button" (click)="previousWeek()">Previous week</button>
            <strong>{{ calendarDays[0]?.date | date: 'MMM d' }} - {{ calendarDays[4]?.date | date: 'MMM d, y' }}</strong>
            <button class="button ghost" type="button" (click)="nextWeek()">Next week</button>
          </div>
        </div>

        <div class="table-wrap" *ngIf="role === 'admin'; else nonAdmin">
          <table class="calendar-table">
            <thead>
              <tr>
                <th>Time</th>
                <th *ngFor="let day of calendarDays">{{ day.label }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of calendarRows; let rowIndex = index">
                <th>
                  <span *ngIf="row[0].hourLabel">{{ row[0].hourLabel }}</span>
                </th>
                <td *ngFor="let cell of row">
                  <button
                    type="button"
                    class="cell"
                    [ngClass]="{ blocked: !!cell.blockedId }"
                    [disabled]="isSaving"
                    (click)="toggleBlocked(cell)">
                    {{ cell.blockedId ? 'Blocked' : 'Available' }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <ng-template #nonAdmin>
          <p class="error">Only admins can manage blocked times.</p>
        </ng-template>

        <p class="success" *ngIf="adminMessage">{{ adminMessage }}</p>
        <p class="error" *ngIf="adminError">{{ adminError }}</p>
      </div>
    </section>
  </main>
</div>
